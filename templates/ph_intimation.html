<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Personal Hearing Intimation</title>
    {{ full_styles_html | safe }}
    <style>
        .header-line {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
        }

        .address-block p {
            margin: 0;
            line-height: 1.4;
        }

        .subject {
            text-align: justify;
        }

        .signature-block {
            margin-left: 60%;
            text-align: left;
        }

        .copy-block p {
            margin: 2px 0;
        }
    </style>
</head>

<body>
    {% macro render_content() %}
    <!-- Letterhead -->
    {% if letter_head %}
    <div class="letterhead-container">
        {{ letter_head | safe }}
    </div>
    {% endif %}

    <!-- OC No and Date Row -->
    <div class="header-line">
        <div>O.C. No. {{ oc_no }}</div>
        <div>Date: {{ issue_date }}</div>
    </div>

    <br><br>

    <div class="address-block">
        <p>To,</p>
        <p>{{ legal_name }}</p>
        <p>GSTIN: {{ gstin }}</p>
        <p>{{ address }}</p>
    </div>

    <br>

    <p>Gentlemen/Sir/Madam,</p>

    <br>

    <p class="subject">
        <strong>Subject: Intimation of Personal Hearing â€“ reg</strong>
    </p>

    <br>

    <p>
        <strong>References:</strong>
        1. SCN reference number: {{ scn_no }} dated {{ scn_date }}
    </p>

    <br>

    <p>
        1. Please refer to the above mentioned SCN number issued by Office of the Superintendent Paravur Range.
    </p>

    <p>
        2. In this connection, it is to inform you that personal hearing in this case will be held at {{ ph_time }}
        on {{ ph_date }} before the {{ officer_designation }} of Central Tax, {{ office_address }}.
    </p>

    <p>
        3. You may therefore appear in person or through an authorized representative for the personal hearing on
        the above mentioned date and time as per your convenience, at the above mentioned address, without fail
        along with records/documents/evidences you wish to rely upon in support of your case.
    </p>

    <br><br><br>

    <div class="signature-block">
        <p>{{ officer_name }}</p>
        <p>{{ officer_designation }}</p>
    </div>

    <br><br>

    <div class="copy-block">
        <p><strong>Copy submitted to:</strong></p>
        <p>1. {{ copy_to }}</p>
    </div>
    {% endmacro %}

    <!-- A4 Simulator Wrapper (Only for Preview) -->
    {% if not for_pdf %}
    <div class="page-wrapper" id="ph-preview-wrapper">
        <!-- JS will inject discrete .a4-page containers here -->
    </div>

    <!-- Hidden source content for pagination -->
    <div id="ph-source-content" class="doc-content"
        style="display: none; visibility: hidden; position: absolute; width: 680px;">
        {{ render_content() }}
    </div>

    <script>
        /**
         * Unified A4 Pagination Engine
         */
        const PAGE_HEIGHT = 1123;
        const TOP_PADDING = 57;
        const BOTTOM_PADDING = 57;
        const CONTENT_MAX_HEIGHT = PAGE_HEIGHT - TOP_PADDING - BOTTOM_PADDING;

        function createNewPage() {
            const wrapper = document.getElementById('ph-preview-wrapper');
            const page = document.createElement('div');
            page.className = 'a4-page';

            const documentDiv = document.createElement('div');
            documentDiv.className = 'doc-content';
            page.appendChild(documentDiv);

            wrapper.appendChild(page);
            return documentDiv;
        }

        function paginate() {
            const source = document.getElementById('ph-source-content');
            const wrapper = document.getElementById('ph-preview-wrapper');
            if (!source || !wrapper) return;

            wrapper.innerHTML = '';
            source.style.display = 'block';
            source.style.width = '680px';

            let currentPageContainer = createNewPage();
            const children = Array.from(source.children);

            children.forEach(child => {
                const childHeight = child.offsetHeight;
                const currentContentHeight = currentPageContainer.offsetHeight;

                if (currentContentHeight + childHeight <= CONTENT_MAX_HEIGHT) {
                    currentPageContainer.appendChild(child.cloneNode(true));
                } else {
                    currentPageContainer = createNewPage();
                    currentPageContainer.appendChild(child.cloneNode(true));
                }
            });

            source.style.display = 'none';
        }

        window.addEventListener('load', () => setTimeout(paginate, 150));
    </script>
    {% else %}
    <!-- Static PDF Rendering (WeasyPrint) -->
    <div class="a4-page-static">
        <div class="doc-content">
            {{ render_content() }}
        </div>
    </div>
    {% endif %}
</body>

</html>